<% content_for :title, "Configuration OpenAI - Paramètres Admin" %>

<div class="admin-page-header">
  <%= link_to "← Retour aux paramètres", admin_settings_path, class: "back-link" %>
  <h1>Configuration OpenAI</h1>
  <p class="text-muted">IA (GPT) + transcription (Whisper)</p>
</div>

<div class="admin-card">
  <div class="card-header">
    <h2>Configuration API</h2>
  </div>

  <%= form_with model: @app_setting, url: admin_settings_openai_path, method: :patch, class: "settings-form" do |f| %>
    <div class="form-group">
      <%= f.label :openai_api_key, "API Key", class: "form-label" %>
      <%= f.password_field :openai_api_key, class: "form-input", value: nil, placeholder: "sk-..." %>
      <small class="form-hint">Clé OpenAI (enregistrée chiffrée)</small>
    </div>

    <div class="form-group">
      <%= f.label :openai_model, "Modèle", class: "form-label" %>
      <%= f.text_field :openai_model, class: "form-input", placeholder: "gpt-4" %>
      <small class="form-hint">Ex: gpt-4, gpt-4.1-mini…</small>
    </div>

    <div class="form-actions">
      <%= f.submit "Sauvegarder", class: "btn btn-primary" %>
    </div>
  <% end %>
</div>

<div class="admin-card" style="margin-top: var(--spacing-xl);">
  <div class="card-header">
    <h2>Test de connexion</h2>
    <%= button_to admin_settings_test_connection_path(service: 'openai'), method: :post, class: "btn btn-primary", form: { data: { turbo: false } } do %>
      Tester la connexion
    <% end %>
  </div>

  <% if @app_setting.openai_configured? %>
    <div class="alert alert-info">
      Configuration détectée. Lancez un test pour vérifier l'accès à l'API OpenAI.
    </div>
  <% else %>
    <div class="alert alert-warning">
      OpenAI n'est pas configuré (API key requise).
    </div>
  <% end %>
</div>
