<% content_for :title, "Configuration Stripe - Paramètres Admin" %>

<div class="admin-page-header">
  <%= link_to "← Retour aux paramètres", admin_settings_path, class: "back-link" %>
  <h1>Configuration Stripe</h1>
  <p class="text-muted">Gestion des paiements et abonnements</p>
</div>

<div class="admin-card">
  <div class="card-header">
    <h2>Configuration API</h2>
  </div>

  <%= form_with model: @app_setting, url: admin_settings_stripe_path, method: :patch, class: "settings-form" do |f| %>
    <div class="form-group">
      <%= f.label :stripe_publishable_key, "Publishable key", class: "form-label" %>
      <%= f.text_field :stripe_publishable_key, class: "form-input", placeholder: "pk_live_..." %>
    </div>

    <div class="form-group">
      <%= f.label :stripe_secret_key, "Secret key", class: "form-label" %>
      <%= f.password_field :stripe_secret_key, class: "form-input", value: nil, placeholder: "sk_live_..." %>
      <small class="form-hint">Clé secrète (enregistrée chiffrée)</small>
    </div>

    <div class="form-group">
      <%= f.label :stripe_webhook_secret, "Webhook secret", class: "form-label" %>
      <%= f.password_field :stripe_webhook_secret, class: "form-input", value: nil, placeholder: "whsec_..." %>
      <small class="form-hint">Secret de vérification webhook (enregistré chiffré)</small>
    </div>

    <div class="form-group">
      <%= f.label :stripe_price_id, "Price ID", class: "form-label" %>
      <%= f.text_field :stripe_price_id, class: "form-input", placeholder: "price_..." %>
    </div>

    <div class="form-actions">
      <%= f.submit "Sauvegarder", class: "btn btn-primary" %>
    </div>
  <% end %>
</div>

<div class="admin-card" style="margin-top: var(--spacing-xl);">
  <div class="card-header">
    <h2>Test de connexion</h2>
    <%= button_to admin_settings_test_connection_path(service: 'stripe'), method: :post, class: "btn btn-primary", form: { data: { turbo: false } } do %>
      Tester la connexion
    <% end %>
  </div>

  <% if @app_setting.stripe_configured? %>
    <div class="alert alert-info">
      Configuration détectée. Lancez un test pour vérifier l'accès à l'API Stripe.
    </div>
  <% else %>
    <div class="alert alert-warning">
      Stripe n'est pas configuré (secret key + price id requis).
    </div>
  <% end %>
</div>
