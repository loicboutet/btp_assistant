<% content_for :title, "Configuration Unipile - Paramètres Admin" %>

<div class="admin-page-header">
  <%= link_to "← Retour aux paramètres", admin_settings_path, class: "back-link" %>
  <h1>Configuration Unipile</h1>
  <p class="text-muted">Gestion de l'intégration WhatsApp via Unipile</p>
</div>

<!-- Status Overview -->
<div class="stats-grid">
  <div class="stat-card">
    <div class="stat-label">Statut de connexion</div>
    <div class="stat-value"><span class="status-badge status-success">Connecté</span></div>
    <div class="stat-detail">API fonctionnelle</div>
  </div>
  <div class="stat-card">
    <div class="stat-label">Comptes WhatsApp</div>
    <div class="stat-value">44</div>
    <div class="stat-detail">93.6% des utilisateurs</div>
  </div>
  <div class="stat-card">
    <div class="stat-label">Messages (24h)</div>
    <div class="stat-value">247</div>
    <div class="stat-detail">98.4% succès</div>
  </div>
  <div class="stat-card">
    <div class="stat-label">Dernière activité</div>
    <div class="stat-value">2 min</div>
    <div class="stat-detail success-text">Actif</div>
  </div>
</div>

<!-- Configuration Form -->
<div class="admin-card" style="margin-top: var(--spacing-xl);">
  <div class="card-header">
    <h2>Configuration API</h2>
    <button class="btn btn-primary">Sauvegarder</button>
  </div>
  <form class="settings-form">
    <div class="form-group">
      <label class="form-label">API Key</label>
      <input type="password" class="form-input" value="unipile_pk_••••••••••••••••" placeholder="unipile_pk_...">
      <small class="form-hint">Clé API Unipile (production)</small>
    </div>

    <div class="form-group">
      <label class="form-label">API Secret</label>
      <input type="password" class="form-input" value="••••••••••••••••••••••••" placeholder="Secret">
      <small class="form-hint">Secret API pour la signature des webhooks</small>
    </div>

    <div class="form-group">
      <label class="form-label">Webhook URL</label>
      <input type="url" class="form-input" value="https://deviswhatsapp.fr/webhooks/unipile/messages" readonly>
      <small class="form-hint">URL configurée dans Unipile pour recevoir les webhooks</small>
    </div>

    <div class="form-group">
      <label class="form-label">Environnement</label>
      <select class="form-select">
        <option>Test</option>
        <option selected>Production</option>
      </select>
      <small class="form-hint">Environnement Unipile utilisé</small>
    </div>
  </form>
</div>

<!-- Test Connection -->
<div class="admin-card" style="margin-top: var(--spacing-xl);">
  <div class="card-header">
    <h2>Test de connexion</h2>
    <%= link_to "Tester la connexion", admin_settings_unipile_test_path, method: :post, class: "btn btn-primary", data: { confirm: "Tester la connexion Unipile ?" } %>
  </div>
  <div class="alert alert-success">
    <strong>✓ Dernière test réussi</strong><br>
    Il y a 5 minutes - API opérationnelle, tous les endpoints fonctionnels
  </div>
</div>

<!-- Statistics -->
<div class="admin-card" style="margin-top: var(--spacing-xl);">
  <div class="card-header">
    <h2>Statistiques d'utilisation</h2>
  </div>
  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-label">Messages reçus (30j)</div>
      <div class="stat-value">3 247</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">Messages vocaux transcrits</div>
      <div class="stat-value">1 892</div>
      <div class="stat-detail">58.3% du total</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">Taux de succès</div>
      <div class="stat-value success-text">98.4%</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">Temps de réponse moyen</div>
      <div class="stat-value">1.3s</div>
    </div>
  </div>
</div>

<!-- Webhook Events -->
<div class="admin-card" style="margin-top: var(--spacing-xl);">
  <div class="card-header">
    <h2>Événements Webhook configurés</h2>
  </div>
  <div class="webhook-events-list">
    <div class="webhook-event-item">
      <span class="status-badge status-success">✓</span>
      <div>
        <strong>message.received</strong>
        <p class="text-muted small">Déclenché quand un message WhatsApp est reçu</p>
      </div>
    </div>
    <div class="webhook-event-item">
      <span class="status-badge status-success">✓</span>
      <div>
        <strong>account.connected</strong>
        <p class="text-muted small">Déclenché quand un compte WhatsApp est connecté</p>
      </div>
    </div>
    <div class="webhook-event-item">
      <span class="status-badge status-success">✓</span>
      <div>
        <strong>account.disconnected</strong>
        <p class="text-muted small">Déclenché quand un compte WhatsApp est déconnecté</p>
      </div>
    </div>
  </div>
</div>
