<% content_for :title, "Configuration Unipile - Paramètres Admin" %>

<div class="admin-page-header">
  <%= link_to "← Retour aux paramètres", admin_settings_path, class: "back-link" %>
  <h1>Configuration Unipile</h1>
  <p class="text-muted">Gestion de l'intégration WhatsApp via Unipile</p>
</div>

<div class="admin-card">
  <div class="card-header">
    <h2>Configuration API</h2>
  </div>

  <%= form_with model: @app_setting, url: admin_settings_unipile_path, method: :patch, class: "settings-form" do |f| %>
    <div class="form-group">
      <%= f.label :unipile_dsn, "DSN / Base URL", class: "form-label" %>
      <%= f.text_field :unipile_dsn, class: "form-input", placeholder: "https://api1.unipile.com:13211" %>
      <small class="form-hint">URL de l'API Unipile</small>
    </div>

    <div class="form-group">
      <%= f.label :unipile_account_id, "Account ID", class: "form-label" %>
      <%= f.text_field :unipile_account_id, class: "form-input", placeholder: "acc_..." %>
      <small class="form-hint">Identifiant du compte WhatsApp connecté côté Unipile</small>
    </div>

    <div class="form-group">
      <%= f.label :unipile_api_key, "API Key", class: "form-label" %>
      <%= f.password_field :unipile_api_key, class: "form-input", value: nil, placeholder: "unipile_pk_..." %>
      <small class="form-hint">Clé API Unipile (enregistrée chiffrée)</small>
    </div>

    <div class="form-actions">
      <%= f.submit "Sauvegarder", class: "btn btn-primary" %>
    </div>
  <% end %>
</div>

<div class="admin-card" style="margin-top: var(--spacing-xl);">
  <div class="card-header">
    <h2>Test de connexion</h2>
    <%= button_to admin_settings_test_connection_path(service: 'unipile'), method: :post, class: "btn btn-primary", form: { data: { turbo: false } } do %>
      Tester la connexion
    <% end %>
  </div>

  <% if @app_setting.unipile_configured? %>
    <div class="alert alert-info">
      Configuration détectée. Lancez un test pour vérifier la connexion.
    </div>
  <% else %>
    <div class="alert alert-warning">
      Unipile n'est pas configuré (DSN / Account ID / API key).
    </div>
  <% end %>
</div>
