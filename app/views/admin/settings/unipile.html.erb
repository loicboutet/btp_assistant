<% content_for :title, "Configuration Unipile - Paramètres Admin" %>

<div class="admin-page-header">
  <%= link_to "← Retour aux paramètres", admin_settings_path, class: "back-link" %>
  <h1>Configuration Unipile</h1>
  <p class="text-muted">Gestion de l'intégration WhatsApp via Unipile</p>
</div>

<!-- Status Overview -->
<div class="stats-grid">
  <div class="stat-card">
    <div class="stat-icon bg-green">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" width="32" height="32">
        <path stroke-linecap="round" stroke-linejoin="round" d="M13.19 8.688a4.5 4.5 0 011.242 7.244l-4.5 4.5a4.5 4.5 0 01-6.364-6.364l1.757-1.757m13.35-.622l1.757-1.757a4.5 4.5 0 00-6.364-6.364l-4.5 4.5a4.5 4.5 0 001.242 7.244" />
      </svg>
    </div>
    <div class="stat-content">
      <div class="stat-value"><span class="status-badge status-success">Connecté</span></div>
      <div class="stat-label">Statut de connexion</div>
      <div class="stat-detail">API fonctionnelle</div>
    </div>
  </div>
  <div class="stat-card">
    <div class="stat-icon bg-blue">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" width="32" height="32">
        <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 6.75c0 8.284 6.716 15 15 15h2.25a2.25 2.25 0 002.25-2.25v-1.372c0-.516-.351-.966-.852-1.091l-4.423-1.106c-.44-.11-.902.055-1.173.417l-.97 1.293c-.282.376-.769.542-1.21.38a12.035 12.035 0 01-7.143-7.143c-.162-.441.004-.928.38-1.21l1.293-.97c.363-.271.527-.734.417-1.173L6.963 3.102a1.125 1.125 0 00-1.091-.852H4.5A2.25 2.25 0 002.25 4.5v2.25z" />
      </svg>
    </div>
    <div class="stat-content">
      <div class="stat-value">44</div>
      <div class="stat-label">Comptes WhatsApp</div>
      <div class="stat-detail">93.6% des utilisateurs</div>
    </div>
  </div>
  <div class="stat-card">
    <div class="stat-icon bg-purple">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" width="32" height="32">
        <path stroke-linecap="round" stroke-linejoin="round" d="M8.625 12a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H8.25m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H12m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0h-.375M21 12c0 4.556-4.03 8.25-9 8.25a9.764 9.764 0 01-2.555-.337A5.972 5.972 0 015.41 20.97a5.969 5.969 0 01-.474-.065 4.48 4.48 0 00.978-2.025c.09-.457-.133-.901-.467-1.226C3.93 16.178 3 14.189 3 12c0-4.556 4.03-8.25 9-8.25s9 3.694 9 8.25z" />
      </svg>
    </div>
    <div class="stat-content">
      <div class="stat-value">247</div>
      <div class="stat-label">Messages (24h)</div>
      <div class="stat-detail">98.4% succès</div>
    </div>
  </div>
  <div class="stat-card">
    <div class="stat-icon bg-orange">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" width="32" height="32">
        <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z" />
      </svg>
    </div>
    <div class="stat-content">
      <div class="stat-value">2 min</div>
      <div class="stat-label">Dernière activité</div>
      <div class="stat-detail success-text">Actif</div>
    </div>
  </div>
</div>

<!-- Configuration Form -->
<div class="admin-card" style="margin-top: var(--spacing-xl);">
  <div class="card-header">
    <h2>Configuration API</h2>
    <button class="btn btn-primary" style="display: inline-flex; align-items: center; gap: 0.5rem;">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" width="16" height="16">
        <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
      </svg>
      <span>Sauvegarder</span>
    </button>
  </div>
  <form class="settings-form">
    <div class="form-group">
      <label class="form-label">API Key</label>
      <input type="password" class="form-input" value="unipile_pk_••••••••••••••••" placeholder="unipile_pk_...">
      <small class="form-hint">Clé API Unipile (production)</small>
    </div>

    <div class="form-group">
      <label class="form-label">API Secret</label>
      <input type="password" class="form-input" value="••••••••••••••••••••••••" placeholder="Secret">
      <small class="form-hint">Secret API pour la signature des webhooks</small>
    </div>

    <div class="form-group">
      <label class="form-label">Webhook URL</label>
      <input type="url" class="form-input" value="https://deviswhatsapp.fr/webhooks/unipile/messages" readonly>
      <small class="form-hint">URL configurée dans Unipile pour recevoir les webhooks</small>
    </div>

    <div class="form-group">
      <label class="form-label">Environnement</label>
      <select class="form-select">
        <option>Test</option>
        <option selected>Production</option>
      </select>
      <small class="form-hint">Environnement Unipile utilisé</small>
    </div>
  </form>
</div>

<!-- Test Connection -->
<div class="admin-card" style="margin-top: var(--spacing-xl);">
  <div class="card-header">
    <h2>Test de connexion</h2>
    <%= link_to admin_settings_unipile_test_path, method: :post, class: "btn btn-primary", data: { confirm: "Tester la connexion Unipile ?" }, style: "display: inline-flex; align-items: center; gap: 0.5rem;" do %>
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" width="16" height="16">
        <path stroke-linecap="round" stroke-linejoin="round" d="M5.636 5.636a9 9 0 1012.728 0M12 3v9" />
      </svg>
      <span>Tester la connexion</span>
    <% end %>
  </div>
  <div class="alert alert-success">
    <strong>✓ Dernière test réussi</strong><br>
    Il y a 5 minutes - API opérationnelle, tous les endpoints fonctionnels
  </div>
</div>

<!-- Statistics -->
<div class="admin-card" style="margin-top: var(--spacing-xl);">
  <div class="card-header">
    <h2>Statistiques d'utilisation</h2>
  </div>
  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-label">Messages reçus (30j)</div>
      <div class="stat-value">3 247</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">Messages vocaux transcrits</div>
      <div class="stat-value">1 892</div>
      <div class="stat-detail">58.3% du total</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">Taux de succès</div>
      <div class="stat-value success-text">98.4%</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">Temps de réponse moyen</div>
      <div class="stat-value">1.3s</div>
    </div>
  </div>
</div>

<!-- Webhook Events -->
<div class="admin-card" style="margin-top: var(--spacing-xl);">
  <div class="card-header">
    <h2>Événements Webhook configurés</h2>
  </div>
  <div class="webhook-events-list">
    <div class="webhook-event-item">
      <span class="status-badge status-success">✓</span>
      <div>
        <strong>message.received</strong>
        <p class="text-muted small">Déclenché quand un message WhatsApp est reçu</p>
      </div>
    </div>
    <div class="webhook-event-item">
      <span class="status-badge status-success">✓</span>
      <div>
        <strong>account.connected</strong>
        <p class="text-muted small">Déclenché quand un compte WhatsApp est connecté</p>
      </div>
    </div>
    <div class="webhook-event-item">
      <span class="status-badge status-success">✓</span>
      <div>
        <strong>account.disconnected</strong>
        <p class="text-muted small">Déclenché quand un compte WhatsApp est déconnecté</p>
      </div>
    </div>
  </div>
</div>
