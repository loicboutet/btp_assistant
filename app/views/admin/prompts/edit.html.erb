<% content_for :title, "Éditer prompt - Admin" %>

<div class="admin-page-header">
  <%= link_to "← Retour", admin_prompts_path, class: "back-link" %>
  <h1>Éditer le prompt</h1>
  <p class="text-muted"><code><%= @prompt.name %></code></p>
</div>

<div class="admin-card">
  <div class="card-header">
    <h2>Édition</h2>
  </div>

  <%= form_with model: @prompt, url: admin_prompt_path(@prompt), method: :patch, class: "settings-form" do |f| %>
    <div class="form-group">
      <%= f.label :description, "Description", class: "form-label" %>
      <%= f.text_field :description, class: "form-input" %>
    </div>

    <div class="form-group">
      <%= f.label :is_active, "Actif", class: "form-label" %>
      <%= f.check_box :is_active %>
    </div>

    <div class="form-group">
      <%= f.label :prompt_text, "Prompt", class: "form-label" %>
      <%= f.text_area :prompt_text, class: "form-input", rows: 18 %>
      <small class="form-hint">Toute modification incrémente automatiquement la version.</small>
    </div>

    <div class="form-actions">
      <%= f.submit "Sauvegarder", class: "btn btn-primary" %>
    </div>
  <% end %>
</div>

<div class="admin-card" style="margin-top: var(--spacing-xl);">
  <div class="card-header">
    <h2>Tester ce prompt (minimal)</h2>
  </div>

  <%= form_with url: test_admin_prompt_path(@prompt), method: :post, class: "settings-form", data: { turbo: false } do %>
    <div class="form-group">
      <label class="form-label">Input utilisateur</label>
      <textarea name="input" rows="4" class="form-input"><%= @test_input || "Bonjour" %></textarea>
    </div>

    <div class="form-group">
      <label class="form-label">Température</label>
      <input type="number" name="temperature" class="form-input" min="0" max="2" step="0.1" value="0.2">
    </div>

    <div class="form-actions">
      <button type="submit" class="btn btn-primary">Lancer le test</button>
    </div>
  <% end %>

  <% if @test_output.present? %>
    <div class="admin-card" style="margin-top: var(--spacing-lg);">
      <div class="card-header">
        <h3>Résultat</h3>
      </div>
      <pre style="white-space: pre-wrap;"><%= @test_output %></pre>
    </div>
  <% end %>
</div>
