<% content_for :title, "D√©tails Abonnement - Admin" %>

<div class="admin-page-header">
  <div style="display: flex; justify-content: space-between; align-items: center;">
    <div>
      <h1>D√©tails de l'abonnement</h1>
      <p class="text-muted">Abonnement #<%= @subscription.id %></p>
    </div>
    <%= link_to admin_subscriptions_path, class: "btn btn-outline" do %>
      ‚Üê Retour aux abonnements
    <% end %>
  </div>
</div>

<!-- User Information -->
<div class="admin-card">
  <div class="card-header">
    <h2>Informations utilisateur</h2>
  </div>
  <div style="padding: var(--spacing-lg);">
    <div class="user-info" style="margin-bottom: var(--spacing-lg);">
      <div class="user-avatar" style="width: 60px; height: 60px; font-size: 24px;"><%= @subscription.user.name.split.map(&:first).join.upcase %></div>
      <div>
        <div class="user-name" style="font-size: 1.25rem; font-weight: 600;"><%= @subscription.user.name %></div>
        <div class="user-email"><%= @subscription.user.email %></div>
        <%= link_to admin_user_path(@subscription.user.id), class: "btn btn-sm btn-outline", style: "margin-top: var(--spacing-sm);" do %>
          üë§ Voir le profil complet
        <% end %>
      </div>
    </div>
  </div>
</div>

<!-- Subscription Details -->
<div class="admin-card" style="margin-top: var(--spacing-lg);">
  <div class="card-header">
    <h2>D√©tails de l'abonnement</h2>
  </div>
  <div style="padding: var(--spacing-lg);">
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: var(--spacing-lg);">
      <div>
        <div class="text-muted small">Plan</div>
        <div style="font-weight: 600; margin-top: var(--spacing-xs);"><%= @subscription.plan %></div>
      </div>
      <div>
        <div class="text-muted small">Statut</div>
        <div style="margin-top: var(--spacing-xs);">
          <span class="status-badge status-success"><%= @subscription.status.capitalize %></span>
        </div>
      </div>
      <div>
        <div class="text-muted small">Montant</div>
        <div style="font-weight: 600; margin-top: var(--spacing-xs); color: var(--color-success);"><%= @subscription.amount %>‚Ç¨ / <%= @subscription.interval %></div>
      </div>
      <div>
        <div class="text-muted small">Date de d√©but</div>
        <div style="font-weight: 600; margin-top: var(--spacing-xs);"><%= @subscription.current_period_start.strftime('%d %B %Y') rescue 'N/A' %></div>
      </div>
      <div>
        <div class="text-muted small">Prochain paiement</div>
        <div style="font-weight: 600; margin-top: var(--spacing-xs);"><%= @subscription.current_period_end.strftime('%d %B %Y') rescue 'N/A' %></div>
      </div>
      <div>
        <div class="text-muted small">Cr√©√© le</div>
        <div style="font-weight: 600; margin-top: var(--spacing-xs);"><%= @subscription.created_at.strftime('%d %B %Y') rescue 'N/A' %></div>
      </div>
    </div>
  </div>
</div>

<!-- Stripe Information -->
<div class="admin-card" style="margin-top: var(--spacing-lg);">
  <div class="card-header">
    <h2>Informations Stripe</h2>
  </div>
  <div style="padding: var(--spacing-lg);">
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: var(--spacing-lg);">
      <div>
        <div class="text-muted small">M√©thode de paiement</div>
        <div style="margin-top: var(--spacing-xs);">
          <div>üí≥ <%= @subscription.payment_method.brand %> ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ <%= @subscription.payment_method.last4 %></div>
          <div class="text-muted small">Expire <%= @subscription.payment_method.exp_month %>/<%= @subscription.payment_method.exp_year %></div>
        </div>
      </div>
      <div>
        <div class="text-muted small">Devise</div>
        <div style="font-weight: 600; margin-top: var(--spacing-xs);"><%= @subscription.currency.upcase %></div>
      </div>
      <div>
        <div class="text-muted small">Type d'intervalle</div>
        <div style="font-weight: 600; margin-top: var(--spacing-xs);"><%= @subscription.interval.capitalize %></div>
      </div>
    </div>
  </div>
</div>

<!-- Payment History -->
<div class="admin-card" style="margin-top: var(--spacing-lg);">
  <div class="card-header">
    <h2>Historique des paiements</h2>
  </div>
  <table class="admin-table">
    <thead>
      <tr>
        <th>Date</th>
        <th>Invoice ID</th>
        <th>Montant</th>
        <th>Statut</th>
      </tr>
    </thead>
    <tbody>
      <% @subscription.invoices.each do |invoice| %>
        <tr>
          <td><%= invoice.date.strftime('%d %B %Y') rescue 'N/A' %></td>
          <td style="font-family: monospace;">inv_<%= invoice.id %></td>
          <td class="font-weight-bold"><%= invoice.amount %>‚Ç¨</td>
          <td><span class="status-badge status-success"><%= invoice.status.capitalize %></span></td>
        </tr>
      <% end %>
    </tbody>
  </table>
</div>

<!-- Actions -->
<div class="admin-card" style="margin-top: var(--spacing-lg);">
  <div class="card-header">
    <h2>Actions</h2>
  </div>
  <div style="padding: var(--spacing-lg);">
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: var(--spacing-md);">
      <button class="btn btn-primary">
        üí≥ Acc√©der au portail Stripe
      </button>
      <button class="btn btn-outline">
        ‚ùå Annuler l'abonnement
      </button>
      <button class="btn btn-outline">
        ‚è∏Ô∏è Suspendre l'abonnement
      </button>
      <button class="btn btn-outline">
        üìù Modifier le plan
      </button>
    </div>
  </div>
</div>

<!-- Stats -->
<div class="admin-card" style="margin-top: var(--spacing-xl);">
  <div class="card-header">
    <h2>Statistiques</h2>
  </div>
  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-label">Revenu total</div>
      <div class="stat-value">177‚Ç¨</div>
      <div class="stat-detail">3 paiements</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">LTV (Lifetime Value)</div>
      <div class="stat-value">177‚Ç¨</div>
      <div class="stat-detail">Depuis 3 mois</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">Taux de succ√®s</div>
      <div class="stat-value">100%</div>
      <div class="stat-detail">3/3 paiements r√©ussis</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">Prochain paiement</div>
      <div class="stat-value">15 jours</div>
      <div class="stat-detail">Le 15 juin 2025</div>
    </div>
  </div>
</div>
