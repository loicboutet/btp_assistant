<% content_for :title, "Modifier l'abonnement - Admin" %>

<div class="admin-page-header">
  <%= link_to admin_subscription_path(@subscription), class: "back-link" do %>
    ← Retour au détail
  <% end %>
  <h1>Modifier l'abonnement</h1>
  <p class="text-muted">Abonnement #<%= @subscription.id %> • <%= @subscription.user.display_name %></p>
</div>

<div class="admin-card">
  <%= form_with model: @subscription, url: admin_subscription_path(@subscription), method: :patch, local: true do |f| %>

    <div style="margin-bottom: var(--spacing-xl);">
      <h3 style="margin-bottom: var(--spacing-lg); color: var(--primary-green);">Utilisateur</h3>

      <div class="form-group">
        <%= f.label :user_id, "Utilisateur", class: "form-label" %>
        <%= f.select :user_id,
          options_from_collection_for_select(@users_for_select, :id, :display_name, @subscription.user_id),
          {},
          class: "form-select", required: true %>
        <span class="form-hint">Liste limitée aux 200 derniers utilisateurs.</span>
      </div>
    </div>

    <div style="margin-bottom: var(--spacing-xl);">
      <h3 style="margin-bottom: var(--spacing-lg); color: var(--primary-green);">Stripe</h3>

      <div class="form-group">
        <%= f.label :stripe_subscription_id, "Stripe Subscription ID", class: "form-label" %>
        <%= f.text_field :stripe_subscription_id, class: "form-input", required: true %>
      </div>

      <div class="form-group">
        <%= f.label :stripe_price_id, "Stripe Price ID", class: "form-label" %>
        <%= f.text_field :stripe_price_id, class: "form-input" %>
      </div>
    </div>

    <div style="margin-bottom: var(--spacing-xl);">
      <h3 style="margin-bottom: var(--spacing-lg); color: var(--primary-green);">Période & statut</h3>

      <div class="form-group">
        <%= f.label :status, "Statut", class: "form-label" %>
        <%= f.select :status,
          options_for_select([
            ['active', 'active'],
            ['past_due', 'past_due'],
            ['canceled', 'canceled'],
            ['unpaid', 'unpaid'],
            ['incomplete', 'incomplete']
          ], @subscription.status),
          {},
          class: "form-select" %>
      </div>

      <div class="form-fields-grid">
        <div class="form-group">
          <%= f.label :current_period_start, "Début période", class: "form-label" %>
          <%= f.datetime_field :current_period_start, class: "form-input" %>
        </div>

        <div class="form-group">
          <%= f.label :current_period_end, "Fin période", class: "form-label" %>
          <%= f.datetime_field :current_period_end, class: "form-input" %>
        </div>
      </div>

      <div class="form-group">
        <label class="form-label">Annulation</label>
        <div>
          <%= f.check_box :cancel_at_period_end %>
          <%= f.label :cancel_at_period_end, "Annuler à la fin de la période", class: "form-hint" %>
        </div>
      </div>

      <div class="form-group">
        <%= f.label :canceled_at, "Annulé le", class: "form-label" %>
        <%= f.datetime_field :canceled_at, class: "form-input" %>
      </div>
    </div>

    <div class="form-actions">
      <button type="submit" class="btn btn-primary">
        <span>Enregistrer</span>
      </button>
      <%= link_to admin_subscription_path(@subscription), class: "btn btn-secondary" do %>
        <span>Annuler</span>
      <% end %>
    </div>

  <% end %>
</div>
