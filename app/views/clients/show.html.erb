<% content_for :title, "Client - Devis WhatsApp" %>
<% content_for :page_title, "Client" %>
<% content_for :back_path, clients_path %>
<% content_for :active_page, :clients %>

<!-- Content -->
<main class="p-4 max-w-3xl mx-auto">
  
  <!-- Client Header -->
  <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 mb-4">
    <div class="flex justify-between items-start mb-4">
      <div>
        <h2 class="text-2xl font-bold text-gray-900"><%= @client&.name || "Nom Client" %></h2>
        <p class="text-gray-600 mt-1"><%= @client&.address&.split(',')&.last&.strip || "Ville" %></p>
      </div>
      <%= link_to edit_client_path(@client&.id || params[:id]), class: "bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-4 rounded-lg transition" do %>
        ‚úèÔ∏è Modifier
      <% end %>
    </div>
  </div>

  <!-- Client Info -->
  <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 mb-4">
    <h3 class="font-semibold text-gray-900 mb-4">Coordonn√©es</h3>
    
    <div class="space-y-3 text-sm">
      <div class="flex justify-between py-2 border-b border-gray-100">
        <span class="text-gray-600">Nom</span>
        <span class="font-medium text-gray-900"><%= @client&.name || "Client" %></span>
      </div>
      
      <div class="flex justify-between py-2 border-b border-gray-100">
        <span class="text-gray-600">Email</span>
        <span class="font-medium text-gray-900"><%= @client&.email || "-" %></span>
      </div>
      
      <div class="flex justify-between py-2 border-b border-gray-100">
        <span class="text-gray-600">T√©l√©phone</span>
        <span class="font-medium text-gray-900"><%= @client&.phone || "-" %></span>
      </div>
      
      <div class="flex justify-between py-2 border-b border-gray-100">
        <span class="text-gray-600">Adresse</span>
        <span class="font-medium text-gray-900 text-right"><%= @client&.address || "Adresse" %></span>
      </div>
      
      <% if @client&.siret.present? %>
        <div class="flex justify-between py-2">
          <span class="text-gray-600">SIRET</span>
          <span class="font-medium text-gray-900"><%= @client.siret %></span>
        </div>
      <% end %>
    </div>
  </div>

  <!-- Documents -->
  <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
    <h3 class="font-semibold text-gray-900 mb-4">Documents associ√©s</h3>
    
    <div class="grid grid-cols-2 gap-4 mb-4">
      <div class="text-center p-4 bg-blue-50 rounded-lg">
        <p class="text-3xl font-bold text-blue-600"><%= @client&.quotes&.count || 0 %></p>
        <p class="text-sm text-gray-600">Devis</p>
      </div>
      <div class="text-center p-4 bg-green-50 rounded-lg">
        <p class="text-3xl font-bold text-green-600"><%= @client&.invoices&.count || 0 %></p>
        <p class="text-sm text-gray-600">Factures</p>
      </div>
    </div>
    
    <!-- Recent Documents List -->
    <% if @client&.recent_quotes&.any? || @client&.recent_invoices&.any? %>
      <div class="space-y-2">
        <h4 class="text-sm font-medium text-gray-700 mb-2">Documents r√©cents</h4>
        
        <% (@client&.recent_quotes || []).each do |quote| %>
          <%= link_to quote_path(quote.id), class: "block p-3 bg-blue-50 hover:bg-blue-100 rounded-lg transition" do %>
            <div class="flex justify-between items-center">
              <div>
                <p class="font-medium text-gray-900 text-sm">üìÑ <%= quote.number %></p>
                <p class="text-xs text-gray-600"><%= l(quote.created_at, format: :short) rescue "Date" %></p>
              </div>
              <p class="font-semibold text-gray-900"><%= number_to_currency(quote.amount, unit: "", precision: 0) %> ‚Ç¨</p>
            </div>
          <% end %>
        <% end %>
        
        <% (@client&.recent_invoices || []).each do |invoice| %>
          <%= link_to invoice_path(invoice.id), class: "block p-3 bg-green-50 hover:bg-green-100 rounded-lg transition" do %>
            <div class="flex justify-between items-center">
              <div>
                <p class="font-medium text-gray-900 text-sm">üßæ <%= invoice.number %></p>
                <p class="text-xs text-gray-600"><%= l(invoice.created_at, format: :short) rescue "Date" %></p>
              </div>
              <p class="font-semibold text-gray-900"><%= number_to_currency(invoice.amount, unit: "", precision: 0) %> ‚Ç¨</p>
            </div>
          <% end %>
        <% end %>
      </div>
    <% else %>
      <p class="text-center text-gray-500 text-sm py-4">Aucun document pour ce client</p>
    <% end %>
  </div>

</main>
