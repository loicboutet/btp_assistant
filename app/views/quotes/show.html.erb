<% content_for :title, "Devis - Devis WhatsApp" %>
<% content_for :page_title, "Devis" %>
<% content_for :back_path, quotes_path %>
<% content_for :active_page, :quotes %>

<!-- Content -->
<main class="p-4 max-w-3xl mx-auto">
  
  <!-- Quote Header Card -->
  <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 mb-4">
    <div class="flex justify-between items-start mb-4">
      <div>
        <h2 class="text-2xl font-bold text-gray-900"><%= @quote&.number || "DEVIS-2025-XXX" %></h2>
        <p class="text-gray-600"><%= @quote&.client&.name || "Client" %></p>
        <p class="text-sm text-gray-500"><%= l(@quote&.created_at || Time.current, format: :long) %></p>
      </div>
      <span class="px-4 py-2 bg-green-100 text-green-800 font-medium rounded-full">
        <%= @quote&.status&.humanize || "Envoy√©" %>
      </span>
    </div>
    
    <!-- Actions -->
    <div class="grid grid-cols-3 gap-2">
      <%= link_to quote_pdf_quote_path(@quote&.id || params[:id]), class: "bg-gray-100 hover:bg-gray-200 text-gray-800 font-medium py-3 px-4 rounded-lg text-center transition text-sm", target: "_blank" do %>
        üìÑ PDF
      <% end %>
      <%= link_to edit_quote_path(@quote&.id || params[:id]), class: "bg-green-600 hover:bg-green-700 text-white font-medium py-3 px-4 rounded-lg text-center transition text-sm" do %>
        ‚úèÔ∏è Modifier
      <% end %>
      <%= button_to quote_path(@quote&.id || params[:id]), method: :delete, data: { turbo_method: :delete, turbo_confirm: "√ätes-vous s√ªr de vouloir supprimer ce devis ?" }, class: "bg-red-600 hover:bg-red-700 text-white font-medium py-3 px-4 rounded-lg text-center transition text-sm" do %>
        üóëÔ∏è Supprimer
      <% end %>
    </div>
  </div>

  <!-- Client Info -->
  <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 mb-4">
    <h3 class="font-semibold text-gray-900 mb-4">Client</h3>
    <div class="text-sm space-y-2 text-gray-700">
      <p><strong><%= @quote&.client&.name || "Entreprise Dubois" %></strong></p>
      <p><%= @quote&.client&.address || "42 Avenue de la R√©publique, 69003 Lyon" %></p>
      <% if @quote&.client&.siret.present? %>
        <p class="text-gray-600">SIRET: <%= @quote.client.siret %></p>
      <% end %>
    </div>
  </div>

  <!-- Line Items -->
  <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 mb-4">
    <h3 class="font-semibold text-gray-900 mb-4">D√©tails</h3>
    
    <div class="space-y-3">
      <% if @quote&.items&.any? %>
        <% @quote.items.each do |item| %>
          <div class="pb-3 border-b border-gray-100">
            <div class="flex justify-between items-start mb-1">
              <p class="font-medium text-gray-900"><%= item.description %></p>
              <p class="font-bold text-gray-900"><%= number_to_currency(item.total, unit: "", precision: 2) %> ‚Ç¨</p>
            </div>
            <div class="flex justify-between text-sm text-gray-600">
              <span><%= item.quantity %> √ó <%= number_to_currency(item.unit_price, unit: "", precision: 2) %> ‚Ç¨</span>
            </div>
          </div>
        <% end %>
      <% else %>
        <div class="py-3 border-b border-gray-100">
          <div class="flex justify-between items-start mb-1">
            <p class="font-medium text-gray-900">Ma√ßonnerie mur ext√©rieur</p>
            <p class="font-bold text-gray-900">4 250,00 ‚Ç¨</p>
          </div>
          <div class="text-sm text-gray-600">50 m¬≤ √ó 85,00 ‚Ç¨</div>
        </div>
        
        <div class="py-3 border-b border-gray-100">
          <div class="flex justify-between items-start mb-1">
            <p class="font-medium text-gray-900">Dalle b√©ton terrasse</p>
            <p class="font-bold text-gray-900">2 850,00 ‚Ç¨</p>
          </div>
          <div class="text-sm text-gray-600">30 m¬≤ √ó 95,00 ‚Ç¨</div>
        </div>
      <% end %>
    </div>

    <!-- Totals -->
    <div class="mt-6 pt-4 border-t-2 border-gray-300 space-y-2">
      <div class="flex justify-between text-gray-700">
        <span>Sous-total HT</span>
        <span><%= number_to_currency(@quote&.subtotal || 7100, unit: "", precision: 2) %> ‚Ç¨</span>
      </div>
      <div class="flex justify-between text-gray-700">
        <span>TVA (20%)</span>
        <span><%= number_to_currency(@quote&.tax_amount || 1420, unit: "", precision: 2) %> ‚Ç¨</span>
      </div>
      <div class="flex justify-between text-xl font-bold text-gray-900 pt-2 border-t border-gray-200">
        <span>Total TTC</span>
        <span class="text-green-600"><%= number_to_currency(@quote&.total || 8520, unit: "", precision: 2) %> ‚Ç¨</span>
      </div>
    </div>
  </div>

  <!-- Notes (if any) -->
  <% if @quote&.notes.present? %>
    <div class="bg-blue-50 rounded-xl border border-blue-200 p-6">
      <h3 class="font-semibold text-gray-900 mb-2">Notes</h3>
      <p class="text-sm text-gray-700 whitespace-pre-wrap"><%= @quote.notes %></p>
    </div>
  <% end %>

</main>
