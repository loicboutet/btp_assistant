<% content_for :title, "#{@quote.number} - Devis" %>

<!-- Header -->
<div class="header">
  <div class="company-info">
    <div class="company-name"><%= @company.name %></div>
    <div class="company-details">
      <%= @company.address %><br>
      SIRET : <%= @company.siret %><br>
      TVA : <%= @company.tva %><br>
      Tél : <%= @company.phone %><br>
      Email : <%= @company.email %>
    </div>
  </div>
  
  <div class="document-info">
    <div class="document-title">DEVIS</div>
    <div class="document-number"><%= @quote.number %></div>
    <div class="document-date">Date : <%= l(@quote.created_at, format: :long) %></div>
    <div class="document-date">Validité : <%= l(@quote.valid_until, format: :long) %></div>
  </div>
</div>

<!-- Parties -->
<div class="parties">
  <div class="party-box">
    <div class="party-label">Entreprise</div>
    <div class="party-name"><%= @company.name %></div>
    <div class="party-details">
      <%= @company.address %><br>
      SIRET : <%= @company.siret %><br>
      <%= @company.phone %>
    </div>
  </div>
  
  <div class="party-box">
    <div class="party-label">Client</div>
    <div class="party-name"><%= @quote.client.name %></div>
    <div class="party-details">
      <%= @quote.client.address %><br>
      <% if @quote.client.siret.present? %>
        SIRET : <%= @quote.client.siret %><br>
      <% end %>
      <%= @quote.client.phone %><br>
      <%= @quote.client.email %>
    </div>
  </div>
</div>

<!-- Items Table -->
<table class="items-table">
  <thead>
    <tr>
      <th style="width: 50%;">Description</th>
      <th style="width: 15%; text-align: center;">Quantité</th>
      <th style="width: 15%; text-align: right;">Prix unitaire</th>
      <th style="width: 20%; text-align: right;">Total HT</th>
    </tr>
  </thead>
  <tbody>
    <% @quote.items.each do |item| %>
      <tr>
        <td class="item-description"><%= item.description %></td>
        <td class="item-quantity" style="text-align: center;"><%= item.quantity %></td>
        <td style="text-align: right;"><%= number_to_currency(item.unit_price, unit: '', precision: 2) %> €</td>
        <td style="text-align: right; font-weight: 600;"><%= number_to_currency(item.total, unit: '', precision: 2) %> €</td>
      </tr>
    <% end %>
  </tbody>
</table>

<!-- Totals -->
<div class="totals">
  <div class="totals-row subtotal">
    <span>Total HT</span>
    <span><%= number_to_currency(@quote.subtotal, unit: '', precision: 2) %> €</span>
  </div>
  <div class="totals-row vat">
    <span>TVA (<%= @quote.tax_rate %>%)</span>
    <span><%= number_to_currency(@quote.tax_amount, unit: '', precision: 2) %> €</span>
  </div>
  <div class="totals-row total">
    <span>Total TTC</span>
    <span><%= number_to_currency(@quote.total, unit: '', precision: 2) %> €</span>
  </div>
</div>

<!-- Notes -->
<% if @quote.notes.present? %>
  <div class="notes">
    <div class="notes-title">⚠️ Conditions et remarques</div>
    <div class="notes-content"><%= @quote.notes %></div>
  </div>
<% end %>

<!-- Signature Section -->
<div class="signature-section">
  <div class="signature-box">
    <div class="signature-label">Bon pour accord</div>
    <div class="signature-line">Signature du client<br>Date :</div>
  </div>
  
  <div class="signature-box">
    <div class="signature-label">L'entreprise</div>
    <div class="signature-line"><%= @company.name %></div>
  </div>
</div>

<!-- Footer -->
<div class="footer">
  Ce devis est valable jusqu'au <%= l(@quote.valid_until, format: :long) %>.<br>
  En cas d'acceptation, merci de nous retourner ce document signé.<br>
  <%= @company.name %> - SIRET : <%= @company.siret %> - TVA : <%= @company.tva %>
</div>
